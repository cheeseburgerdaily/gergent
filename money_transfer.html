<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Money Transfer</title>

<!-- Nunito Font -->
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* GLOBAL */
body {
    background-color: #150d23;
    margin: 0;
    font-family: "Nunito", sans-serif;
    color: white;
}

/* TOP BAR */
.topbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: #10001f;
    padding: 12px 0;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 20;
}

/* SIDEBAR */
.sidebar {
    position: fixed;
    top: 65px;
    left: 0;
    width: 60px;
    height: 100vh;
    background-color: #10001f;
    padding-top: 60px;
    overflow-x: hidden;
    transition: width 0.25s ease;
    z-index: 10;
}

.sidebar.open { width: 180px; }

.sidebar-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 18px;
    cursor: pointer;
    color: white;
}

.sidebar-item:hover {
    background-color: #30005e;
    border-radius: 8px;
}

.sidebar-text {
    opacity: 0;
    white-space: nowrap;
    transition: opacity 0.2s ease;
    font-size: 16px;
}
.sidebar.open .sidebar-text { opacity: 1; }

/* ICONS */
.home-icon, .cases-icon, .inventory-icon, .trade-icon {
    width: 24px;
    filter: invert(62%) sepia(13%) saturate(722%) hue-rotate(233deg);
    transform: translateY(-5%);
}

/* MENU ICON */
.menu-icon {
    position: absolute;
    left: 17px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 5px;
}
.menu-icon div {
    width: 26px;
    height: 3px;
    background-color: #88719e;
    border-radius: 3px;
}

/* CENTER MONEY BOX */
.center-group {
  display: flex;
  align-items: center;
  gap: 5px;
}

.center-box {
  background-color: #88719e;
  padding: 10px 16px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 700;
  font-size: 16px;
}

/* WALLET BUTTON — full size restored */
.wallet-btn {
  background-color: #2ecc71;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  font-family: "Nunito", sans-serif;
  font-weight: 700;
  cursor: pointer;
  font-size: 16px;
}
.wallet-btn:hover { background-color: #28b863; }

/* TOP RIGHT ICONS */
.settings-icon, .rewards-icon, .profile-icon {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 22px;
    cursor: pointer;
    filter: invert(62%) sepia(13%) saturate(722%) hue-rotate(233deg);
}

.settings-icon { right: 20px; }
.profile-icon  { right: 60px; }
.rewards-icon  { right: 100px; }

/* TRANSFER BOX */
.transfer-box {
    margin-left: 120px;
    margin-top: 150px;
    background: #1b0d2e;
    padding: 35px;
    border-radius: 14px;
    width: 420px;
    box-shadow: 0 0 20px rgba(120, 60, 200, 0.5);
}

.transfer-title {
    font-size: 27px;
    font-weight: 800;
    margin-bottom: 10px;
    color: #c8a4ff;
}

.balance-text {
    font-size: 18px;
    color: #8ae2ff;
    margin-top: 10px;
    margin-bottom: 25px;
    font-weight: 700;
}

.transfer-buttons {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.mode-btn {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    font-size: 17px;
    border: none;
    background: #30005e;
    color: white;
}
.mode-btn.active { background: #6d35c7; }

#amountInput {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 8px;
    background: #140a22;
    color: white;
    font-size: 18px;
    margin-bottom: 20px;
    text-align: center;
    box-sizing: border-box;
}

#confirmBtn {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-weight: 800;
    font-size: 18px;
    cursor: pointer;
    background: #6d35c7;
    color: white;
}
#confirmBtn:hover { transform: scale(1.03); }

</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">

    <div class="menu-icon" onclick="toggleSidebar()">
        <div></div><div></div><div></div>
    </div>

    <div class="center-group">
        <div class="center-box">
            <span id="moneyAmount">$0.00</span>
        </div>

        <!-- Wallet button full size now -->
        <button class="wallet-btn" onclick="location.href='money_transfer.html'">Wallet</button>
    </div>

    <img class="settings-icon" src="images/settings.png" onclick="location.href='settings.html'">
    <img class="rewards-icon" src="images/rewards.png" onclick="location.href='rewards.html'">
    <img class="profile-icon" src="images/profile.png" onclick="location.href='profile.html'">

</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-item" onclick="location.href='index.html'">
        <img src="images/home.png" class="home-icon"><span class="sidebar-text">Home</span>
    </div>

    <div class="sidebar-item" onclick="location.href='casepage.html'">
        <img src="images/cases.png" class="cases-icon"><span class="sidebar-text">Cases</span>
    </div>

    <div class="sidebar-item" onclick="location.href='inventory.html'">
        <img src="images/inventory.png" class="inventory-icon"><span class="sidebar-text">Inventory</span>
    </div>

    <div class="sidebar-item" onclick="location.href='tradeup.html'">
        <img src="images/trade.png" class="trade-icon"><span class="sidebar-text">Trade Ups</span>
    </div>
</div>

<!-- MONEY TRANSFER BOX -->
<div class="transfer-box">

    <div class="transfer-title">Money Transfer</div>

    <div class="balance-text">Balance: <span id="moneyAmount2">$0.00</span></div>

    <div class="transfer-buttons">
        <button id="depositBtn" class="mode-btn active">Deposit</button>
        <button id="withdrawBtn" class="mode-btn">Withdraw</button>
    </div>

    <input id="amountInput" type="number" placeholder="Enter amount ($)" min="0.01" step="0.01">

    <button id="confirmBtn">DEPOSIT</button>

</div>


<div id="notifBar" style="position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.9); color:#fff; padding:10px 16px; border-radius:8px; font-size:14px; font-family:Nunito,Arial,sans-serif; opacity:0; pointer-events:none; transition:opacity .2s ease; z-index:9999;"></div>

<script type="module">
import { supabase, getMoney, setMoney } from "./supabaseClient.js";

const notifBar = document.getElementById("notifBar");
function showNotification(msg, type="info"){
  if(!notifBar) return;
  notifBar.textContent = msg;
  notifBar.style.background = type==="error" ? "#c0392b" : type==="success" ? "#27ae60" : "rgba(0,0,0,0.9)";
  notifBar.style.opacity = 1;
  clearTimeout(window._notifTimer);
  window._notifTimer = setTimeout(()=>{ notifBar.style.opacity = 0; }, 2200);
}

const amountEl = document.getElementById("moneyAmount");
const depositInput = document.querySelector(".deposit-input");
const withdrawInput = document.querySelector(".withdraw-input");
const depositBtn = document.getElementById("depositButton");
const withdrawBtn = document.getElementById("withdrawButton");

async function refreshBalance(){
  if(!localStorage.uid){
    showNotification("Log in to use online deposit/withdraw.", "error");
    if(amountEl) amountEl.textContent = "£" + (parseFloat(localStorage.money||"0").toFixed(2));
    return;
  }
  try{
    const bal = await getMoney(localStorage.uid);
    localStorage.money = String(bal);
    if(amountEl) amountEl.textContent = "£" + bal.toFixed(2);
  }catch(e){
    console.error(e);
    showNotification("Could not load balance.", "error");
  }
}


depositBtn?.addEventListener("click", async () => {
  const v = parseFloat(depositInput?.value || "0");
  if (!(v > 0)) {
    showNotification("Enter a valid deposit amount.", "error");
    return;
  }
  if (!localStorage.uid) {
    // local-only deposit
    const current = parseFloat(localStorage.money || "0");
    const next = current + v;
    localStorage.money = String(next);
    if (depositInput) depositInput.value = "";
    if (amountEl) amountEl.textContent = "£" + next.toFixed(2);
    showNotification("Deposit added locally.", "success");
    return;
  }
  // logged-in: online deposit only
  const bal = await getMoney(localStorage.uid) || 0;
  const next = bal + v;
  try {
    await setMoney(localStorage.uid, next);
    localStorage.money = String(next);
    if (depositInput) depositInput.value = "";
    if (amountEl) amountEl.textContent = "£" + next.toFixed(2);
    showNotification("Deposit successful!", "success");
  } catch (e) {
    console.error(e);
    showNotification("Deposit failed.", "error");
  }
});

withdrawBtn?.addEventListener("click", async ()=>{
  if(!localStorage.uid){
    showNotification("You must be logged in to withdraw online.", "error");
    return;
  }
  const v = parseFloat(withdrawInput?.value||"0");
  if(!(v>0)){
    showNotification("Enter a valid withdraw amount.", "error");
    return;
  }
  const current = parseFloat(localStorage.money||"0");
  if(v>current){
    showNotification("Not enough balance.", "error");
    return;
  }
  const next = current - v;
  try{
    await setMoney(localStorage.uid, next);
    localStorage.money = String(next);
    if(withdrawInput) withdrawInput.value="";
    if(amountEl) amountEl.textContent = "£" + next.toFixed(2);
    showNotification("Withdraw successful!", "success");
  }catch(e){
    console.error(e);
    showNotification("Withdraw failed.", "error");
  }
});

refreshBalance();
</script>
</body>

</html>